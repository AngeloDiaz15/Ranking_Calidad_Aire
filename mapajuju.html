<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ranking AQI Global</title>
  <style>
    body { font-family: Arial; background: #f5f5f5; padding: 20px; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
    th { background-color: #0078d4; color: white; }
    tr:hover { background-color: #f1f1f1; }
    select { margin-top: 10px; padding: 5px; }
  </style>
</head>
<body>

<h1>üåç Ranking Mundial de AQI</h1>
<label for="countryFilter">Filtrar por pa√≠s:</label>
<select id="countryFilter">
  <option value="">Todos</option>
</select>

<table id="aqiTable">
  <thead>
    <tr>
      <th>Posici√≥n</th>
      <th>Estaci√≥n</th>
      <th>Pa√≠s</th>
      <th>AQI</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const token = "090ca286c1bb00d992871976d77c05b6347a17d1";
const url = `https://api.waqi.info/map/bounds/?token=${token}&latlng=-56,-180,70,180`; // global bounds

fetch(url)
  .then(res => res.json())
  .then(data => {
    if (data.status !== "ok") throw new Error("Error al obtener datos");

    // Ordenar por AQI (descendente)
    let stations = data.data.filter(s => s.aqi !== "-" && s.aqi !== null)
                            .sort((a, b) => b.aqi - a.aqi);

    // Crear lista de pa√≠ses √∫nicos
    const countries = [...new Set(stations.map(s => s.station.country || "Desconocido"))].sort();
    const select = document.getElementById("countryFilter");
    countries.forEach(c => {
      const opt = document.createElement("option");
      opt.value = c;
      opt.textContent = c;
      select.appendChild(opt);
    });

    // Mostrar tabla inicial
    renderTable(stations);

    // Filtrar por pa√≠s
    select.addEventListener("change", () => {
      const country = select.value;
      const filtered = country ? stations.filter(s => s.station.country === country) : stations;
      renderTable(filtered);
    });
  })
  .catch(err => console.error(err));

function renderTable(stations) {
  const tbody = document.querySelector("#aqiTable tbody");
  tbody.innerHTML = "";
  stations.slice(0, 100).forEach((s, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${s.station.name}</td>
      <td>${s.station.country || "Desconocido"}</td>
      <td>${s.aqi}</td>
    `;
    tbody.appendChild(tr);
  });
}
</script>

</body>
</html>

